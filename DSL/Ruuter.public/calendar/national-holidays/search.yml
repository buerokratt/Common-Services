# Assign incoming keyword/tag for service endpoint
prepare_parameters:
  assign:
    keyWord: ${incoming.params.keyword || "#national_holidays_today"}
    month: ${incoming.params.month || ""}
    name:  ${incoming.params.name || ""}
  next: switchStep


switchStep:
  switch:
    - condition: ${keyWord == "#prev_national_holiday"}
      next: get_previous_national_holiday
      
    - condition: ${keyWord == "#next_national_holiday"}
      next: get_next_national_holiday

    - condition: ${keyWord == "#national_holidays_today"}
      next: get_national_holidays_today
      
    - condition: ${keyWord == "#national_holidays_ytd"}
      next: get_national_holidays_ytd

    - condition: ${keyWord == "#national_holidays_eoy"}
      next: get_national_holidays_eoy
      
    - condition: ${keyWord == "#national_holidays_by_name"}
      next: get_national_holidays_by_name

    - condition: ${keyWord == "#national_holidays_by_month"}
      next: get_national_holidays_by_month
      
    - condition: ${keyWord == "#all_national_holidays"}
      next: get_all_national_holidays

    - condition: true
      next: handle_unknown_keyword

get_previous_national_holiday:
  requestType: get
  template: "calendar/national-holidays/previous"
  result: get_result
  next: set_tag

get_next_national_holiday:
  requestType: get
  template: "calendar/national-holidays/next"
  result: get_result
  next: set_tag

get_national_holidays_today:
  requestType: get
  template: "calendar/national-holidays/today"
  result: get_result
  next: set_tag

get_national_holidays_ytd:
  requestType: get
  template: "calendar/national-holidays/ytd"
  result: get_result
  next: set_tag

get_national_holidays_eoy:
  requestType: get
  template: "calendar/national-holidays/eoy"
  result: get_result
  next: set_tag

get_national_holidays_by_name:
  requestType: get
  template: "calendar/national-holidays/find/by-name"
  body: 
    params:
      - name: ${name} # Syntax from Alar
  result: get_result
  next: set_tag

get_national_holidays_by_month:
  requestType: get
  template: "calendar/national-holidays/find/by-month"
  body: ${month}
  result: get_result
  next: set_tag

get_all_national_holidays:
  requestType: get
  template: "calendar/national-holidays/national-holidays"
  result: get_result
  next: set_tag

set_tag:
  assign:
    set_tag: 
      - condition: ${keyWord == "#prev_national_holiday"} 
        value: "previous"

      - condition: ${keyWord == "#next_national_holiday"} 
        value: "next"

      - condition: ${keyWord == "#national_holidays_today"} 
        value: "today"

      - condition: ${keyWord == "#national_holidays_ytd"} 
        value: "ytd"

      - condition: ${keyWord == "#national_holidays_eoy"} 
        value: "eoy"

      - condition: ${keyWord == "#national_holidays_by_name"} 
        value: "by-name"

      - condition: ${keyWord == "#national_holidays_by_month"} 
        value: "by-month"

      - condition: ${keyWord == "#all_national_holidays"} 
        value: "all"

      - condition: true
        value: "unknown"
  next: map_result_to_dm

map_result_to_dm:
  requestType: post
  template: "[#DMAPPER]/hbs/calendar/national-holidays/search"
  body:
    response: ${get_result}
    tag: ${set_tag}
  result: mapped_result
  next: log_step

handle_unknown_keyword:
  log: "Received unknown keyword: ${keyWord}"

log_step:
  log: "Mapped response received: ${mapped_result}"
  next: returnValue

returnValue:
  return: ${mapped_result}
